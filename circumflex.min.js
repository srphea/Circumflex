cf={};cf.Image=function(a,b,c){if(typeof a=="number"&&a>0&&b>0&&c)return cf.Image.FromData(a,b,c);else if(typeof a=="string")return cf.Image.FromUrl(a)};cf.Image.FromUrl=function(a){var b=document.createElement("img");b.src=a;return b};cf.Image.FromData=function(a,b,c){var d=document.createElement("canvas");if(d.getContext){for(var e=d.getContext("2d"),f=e.createImageData(d.width=a,d.height=b),h=0;h<a*b*4;++h)f.data[h]=c[h];e.putImageData(f,0,0);return d}};cf.Clock=function(){this.Reset()};
cf.Clock.prototype.GetElapsedTime=function(){return(new Date).getTime()-this._startTime};cf.Clock.prototype.Reset=function(){this._startTime=(new Date).getTime()};cf.Rect=function(a,b,c,d){this.Left=a||0;this.Top=b||0;this.Width=c||0;this.Height=d||0};cf.Rect.prototype.Contains=function(a,b){if(typeof a=="object")b=a.y,a=a.x;return a>=this.Left&&b>=this.Top&&a<=this.Left+this.Width&&b<=this.Top+this.Height};
cf.Rect.prototype.Intersects=function(a,b,c,d){if(typeof a=="object")c=a.Width,d=a.Height,b=a.Top,a=a.Left;var e=Math.max(this.Left,a),f=Math.max(this.Top,b),a=Math.min(this.Left+this.Width,a+c),b=Math.min(this.Top+this.Height,b+d);return e<a&&f<b?new cf.Rect(e,f,a-e,b-f):!1};cf.Matrix3=function(a,b,c,d,e,f,h,j,g){this.data=[a||1,d||0,h||0,b||0,e||1,j||0,c||0,f||0,g||1]};
cf.Matrix3.prototype.Transform=function(a,b){if(typeof a=="object")b=a.y,a=a.x;return{x:this.data[0]*a+this.data[3]*b+this.data[6],y:this.data[1]*a+this.data[4]*b+this.data[7]}};
cf.Matrix3.prototype.Inverse=function(){var a=this.data,b=a[0]*(a[8]*a[4]-a[5]*a[7])-a[1]*(a[8]*a[3]-a[5]*a[6])+a[2]*(a[7]*a[3]-a[4]*a[6]);if(!b)return new cf.Matrix3;return new cf.Matrix3((a[8]*a[4]-a[5]*a[7])/b,-(a[8]*a[3]-a[5]*a[6])/b,(a[7]*a[3]-a[4]*a[6])/b,-(a[8]*a[1]-a[2]*a[6])/b,(a[8]*a[0]-a[2]*a[6])/b,-(a[7]*a[0]-a[1]*a[6])/b,(a[5]*a[1]-a[2]*a[4])/b,-(a[5]*a[0]-a[2]*a[3])/b,(a[4]*a[0]-a[1]*a[3])/b)};
cf.Matrix3.prototype.Multiply=function(a){var b=this.data,a=a.data;return new cf.Matrix3(b[0]*a[0]+b[3]*a[1]+b[6]*a[2],b[0]*a[3]+b[3]*a[4]+b[6]*a[5],b[0]*a[6]+b[3]*a[7]+b[6]*a[8],b[1]*a[0]+b[4]*a[1]+b[7]*a[2],b[1]*a[3]+b[4]*a[4]+b[7]*a[5],b[1]*a[6]+b[4]*a[7]+b[7]*a[8],b[2]*a[0]+b[5]*a[1]+b[8]*a[2],b[2]*a[3]+b[5]*a[4]+b[8]*a[5],b[2]*a[6]+b[5]*a[7]+b[8]*a[8])};cf.Matrix3.prototype.Set=function(a){if(a){var b=this.data;a.setTransform(b[0],b[1],b[3],b[4],b[6],b[7])}};
cf.Matrix3.prototype.Apply=function(a){if(a){var b=this.data;a.transform(b[0],b[1],b[3],b[4],b[6],b[7])}};cf.Matrix3.Transformation=function(a,b,c,d,e,f,h,j,g){j%180==90&&(j=0);g%180==90&&(g=0);var e=e*3.141592654/180,k=Math.cos(e),l=Math.sin(e),e=f*k;k*=h;f=f*l+Math.tan(j*3.141592654/180);h=h*l+Math.tan(g*3.141592654/180);return new cf.Matrix3(e,h,-a*e-b*h+c,-f,k,a*f-b*k+d,0,0,1)};
cf.View=function(a,b,c,d,e,f,h){this._centerX=c||a/2||256;this._centerY=d||b/2||256;this._width=a||e||512;this._height=b||f||512;this._rotation=(h||0)%360;this._pWidth=a||512;this._pHeight=b||512;this._invMatrix=this._matrix=null;this._invMatrixUpdated=this._matrixUpdated=!1;this._transformedRect={};this._transformedRectUpdated=!1};cf.View.prototype.SetCenter=function(a,b){this._centerX=a||0;this._centerY=b||0;this._transformedRectUpdated=this._invMatrixUpdated=this._matrixUpdated=!1};
cf.View.prototype.GetCenter=function(){return{x:this._centerX,y:this._centerY}};cf.View.prototype.SetSize=function(a,b){this._width=a;this._height=b;this._transformedRectUpdated=this._invMatrixUpdated=this._matrixUpdated=!1};cf.View.prototype.GetSize=function(){return{width:this._width,height:this._height}};cf.View.prototype.SetRotation=function(a){this._rotation=a%360;this._transformedRectUpdated=this._invMatrixUpdated=this._matrixUpdated=!1};cf.View.prototype.GetRotation=function(){return this._rotation};
cf.View.prototype._getMatrix=function(){if(!this._matrixUpdated)this._matrix=cf.Matrix3.Transformation(this._centerX,this._centerY,this._pWidth/2,this._pHeight/2,-this._rotation,this._pWidth/this._width,this._pHeight/this._height),this._matrixUpdated=!0;return this._matrix};
cf.View.prototype.GetTransformedRect=function(){if(!this._transformedRectUpdated&&this._rotation!=0){var a=this._centerX-this._width/2,b=this._centerY-this._height/2,c=a+this._width,d=b+this._height;pt1=this._getMatrix().Transform(a,b);pt2=this._getMatrix().Transform(c,b);pt3=this._getMatrix().Transform(c,d);pt4=this._getMatrix().Transform(a,d);this._transformedRect={left:Math.min(pt1.x,pt2.x,pt3.x,pt4.x),right:Math.max(pt1.x,pt2.x,pt3.x,pt4.x),top:Math.min(pt1.y,pt2.y,pt3.y,pt4.y),bottom:Math.max(pt1.y,
pt2.y,pt3.y,pt4.y)};this._transformedRectUpdated=!1}else if(!this._transformedRectUpdated)this._transformedRect={left:this._centerX-this._width/2,top:this._centerY-this._height/2,right:this._centerX+this._width/2,bottom:this._centerY+this._height/2},this._transformedRectUpdated=!1;return this._transformedRect};cf.View.prototype._getInvMatrix=function(){if(!this._invMatrixUpdated)this._invMatrix=this._getMatrix().Inverse(),this._invMatrixUpdated=!0;return this._invMatrix};
cf.RenderTarget=function(a,b){this._canvas=document.createElement("canvas");if(this._canvas.getContext)this._ctx=this._canvas.getContext("2d"),this._canvas.width=this.Width=a,this._canvas.height=this.Height=b,this._view=this.DefaultView=new cf.View(this.Width,this.Height),this.ClipShape=null};cf.RenderTarget.prototype.GetView=function(){return this._view};cf.RenderTarget.prototype.SetView=function(a){this._view=a||this.DefaultView};
cf.RenderTarget.prototype.Draw=function(a){if(a&&a._render){var b=this._ctx;this.ClipShape&&this.ClipShape.Path&&(this.ClipShape._getMatrix().Set(b),b.beginPath(),this.ClipShape.Path(b),b.closePath(),b.clip());var c=this._view._getMatrix();c.Set(b);if(a.ShadowBlur){var d=a._getMatrix(),e=a.GetPosition(),f=c.Transform(e.x,e.y),h=d.Transform(e.x,e.y),d=d.Transform(-e.x-a.ShadowOffsetX,-e.y-a.ShadowOffsetY),c=c.Transform(3*e.x-h.x-d.x,3*e.y-h.y-d.y);b.shadowBlur=a.ShadowBlur;b.shadowColor=a.ShadowColor;
b.shadowOffsetX=c.x-f.x;b.shadowOffsetY=c.y-f.y}a._render(b)}};cf.RenderTarget.prototype.Clear=function(a){var b=this._ctx;0 in arguments?(b.save(),b.fillStyle=a,b.fillRect(0,0,this.Width,this.Height),b.restore()):b.clearRect(0,0,this.Width,this.Height)};cf.RenderTarget.prototype.ConvertCoords=function(a,b,c){c||(c=this.GetView());return c._getInvMatrix().Transform(a,b)};
cf.Window=function(a,b,c){function d(){for(var a=f,b=0,c=0;a;)c+=a.offsetTop,b+=a.offsetLeft,a=a.offsetParent;h=b;j=c}function e(){var a=(new Date).getTime();g.Display();a=(new Date).getTime()-a;g._actualFrameTime=a>g.DesiredFrameTime?a:g.DesiredFrameTime;g.Loop&&k(e)}var f=this._canvas,h=0,j=0,g=this;if(typeof b!="number")b=a.clientWidth;if(typeof c!="number")c=a.clientHeight;this.Width=f.width=b;this.Height=f.height=c;this.FrameCount=0;this.DesiredFrameTime=1E3/60;this.Loop=!0;this.MouseY=this.MouseX=
0;this.MousePressed=!1;this.KeyCode=this.Key=this.PMouseY=this.PMouseX=void 0;this.KeysDown={};this._actualFrameTime=0;window.addEventListener("resize",d,!1);f.addEventListener("mouseover",this.MouseOver,!1);f.addEventListener("mouseout",this.MouseOut,!1);f.addEventListener("mousemove",function(a){var b=a.pageX-h,a=a.pageY-j;g.PMouseX==void 0?(g.PMouseX=b,g.PMouseY=a):(g.PMouseX=g.MouseX,g.PMouseY=g.MouseY);g.MouseX=b;g.MouseY=a},!1);f.addEventListener("mousemove",this.MouseMove,!1);f.addEventListener("mousedown",
function(){g.MousePressed=!0;g.MouseDown();f.addEventListener("mousemove",this.MouseDrag,!1);f.removeEventListener("mousemove",this.MouseMove,!1)},!1);f.addEventListener("mouseup",function(){g.MousePressed=!1;g.MouseUp();f.removeEventListener("mousemove",this.MouseDrag,!1);f.addEventListener("mousemove",this.MouseMove,!1)},!1);window.addEventListener("keydown",function(a){a=a.keyCode;g.Key=String.fromCharCode(a);g.KeyCode=a;g.KeysDown[a]=!0;g.KeyDown()},!0);window.addEventListener("keyup",function(a){a=
a.keyCode;g.Key=String.fromCharCode(a);g.KeyCode=a;g.KeysDown[a]=!1;g.KeyUp()},!0);a.appendChild(f);d();var k=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,g._actualFrameTime)}}();e()};cf.Window.prototype=new cf.RenderTarget(0,0);cf.Window.prototype.GetFPS=function(){return 1E3/this._actualFrameTime};cf.Window.prototype.MouseOver=function(){};
cf.Window.prototype.MouseOut=function(){};cf.Window.prototype.MouseDown=function(){};cf.Window.prototype.MouseUp=function(){};cf.Window.prototype.MouseMove=function(){};cf.Window.prototype.MouseDrag=function(){};cf.Window.prototype.KeyDown=function(){};cf.Window.prototype.KeyUp=function(){};cf.Window.prototype.Display=function(){};
cf.Drawable=function(){this._posY=this._posX=0;this._scaleY=this._scaleX=1;this._rotation=this._skewY=this._skewX=this._originY=this._originX=0;this._invMatrix=this._matrix=null;this._InvMatrixUpdated=this._matrixUpdated=!1;this.Alpha=1;this.ShadowOffsetY=this.ShadowOffsetX=this.ShadowBlur=0;this.ShadowColor="#000";this.Composite="source-over"};cf.Drawable.prototype._transformed=function(){};
cf.Drawable.prototype.SetOrigin=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this._originX=a||0;this._originY=b||0;this._InvMatrixUpdated=this._matrixUpdated=!1;this._transformed()};cf.Drawable.prototype.GetOrigin=function(){return{x:this._originX,y:this._originY}};cf.Drawable.prototype.SetPosition=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this._posX=a||0;this._posY=b||0;this._InvMatrixUpdated=this._matrixUpdated=!1;this._transformed()};
cf.Drawable.prototype.GetPosition=function(){return{x:this._posX,y:this._posY}};cf.Drawable.prototype.Move=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this.SetPosition(this._posX+a,this._posY+b)};cf.Drawable.prototype.SetScale=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this._scaleX=a||0;this._scaleY=b||0;this._InvMatrixUpdated=this._matrixUpdated=!1;this._transformed()};cf.Drawable.prototype.GetScale=function(){return{x:this._scaleX,y:this._scaleY}};
cf.Drawable.prototype.Scale=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this.SetScale(this._scaleX*(a||1),this._scaleY*(b||1))};cf.Drawable.prototype.SetSkew=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this._skewX=(a||0)%360;this._skewY=(b||0)%360;this._InvMatrixUpdated=this._matrixUpdated=!1;this._transformed()};cf.Drawable.prototype.GetSkew=function(){return{x:this._skewX,y:this._skewY}};
cf.Drawable.prototype.Skew=function(a,b){if(typeof a=="object")b=a.y,a=a.x;this.SetScale(this._skewX+a,this._skewY+b)};cf.Drawable.prototype.SetRotation=function(a){this._rotation=a%360;this._InvMatrixUpdated=this._matrixUpdated=!1;this._transformed()};cf.Drawable.prototype.GetRotation=function(){return this._rotation};cf.Drawable.prototype.Rotate=function(a){this.SetRotation(this._rotation+a)};
cf.Drawable.prototype._getMatrix=function(){if(!this._matrixUpdated)this._matrix=cf.Matrix3.Transformation(this._originX,this._originY,this._posX,this._posY,this._rotation,this._scaleX,this._scaleY,this._skewX,this._skewY),this._matrixUpdated=!0;return this._matrix};cf.Drawable.prototype._getInvMatrix=function(){if(!this._invMatrixUpdated)this._invMatrix=this._getMatrix().Inverse(),this._invMatrixUpdated=!0;return this._invMatrix};
cf.Drawable.prototype.TransformToLocal=function(a,b){if(typeof a=="object")b=a.y,a=a.x;return this._getInvMatrix().Transform(a,b)};cf.Drawable.prototype.TransformToGlobal=function(a,b){if(typeof a=="object")b=a.y,a=a.x;return this._getMatrix().Transform(a,b)};cf.Drawable.prototype._render=function(a){if(this.Alpha)a.save(),this._getMatrix().Apply(a),a.globalAlpha=this.Alpha,a.globalCompositeOperation=this.Composite,this.Draw(a),a.restore()};
cf.Sprite=function(a,b,c,d,e,f,h,j){this._subrect=new cf.Rect;this._transformedRect=new cf.Rect;this._transformedRectUpdated=!1;this._image=null;this.SetImage(a);this.SetPosition(b||0,c||0);this.SetScale(d||1,e||1);this.SetRotation(f||0);this.SetSkew(h||0,j||0)};cf.Sprite.prototype=new cf.Drawable;cf.Sprite.prototype._transformed=function(){this._transformedRectUpdated=!1};
cf.Sprite.prototype.SetSubrect=function(a,b,c,d){typeof a=="object"?this._subrect=a:(this._subrect.Left=a,this._subrect.Top=b,this._subrect.Width=c,this._subrect.Height=d);this._transformedRectUpdated=!1};cf.Sprite.prototype.GetSubrect=function(){return this._subrect};cf.Sprite.prototype.SetImage=function(a,b){if(!a)return this._image=null;1 in arguments||(b=!1);if(a._canvas)a=a._canvas;(this._image==null||b)&&this.SetSubrect(0,0,a.width,a.height);this._image=a};cf.Sprite.prototype.GetImage=function(){return this._image};
cf.Sprite.prototype.GetTransformedRect=function(a){if(!this._transformedRectUpdated){var b=this._subrect,c=this._transformedRect,d=this._getMatrix(),e=d.Transform(0,0),f=d.Transform(b.Width,0),h=d.Transform(b.Width,b.Height),b=d.Transform(0,b.Height);c.Left=Math.min(e.x,f.x,h.x,b.x);c.Top=Math.min(e.y,f.y,h.y,b.y);c.Width=Math.max(e.x,f.x,h.x,b.x)-c.Left;c.Height=Math.max(e.y,f.y,h.y,b.y)-c.Top;this._transformedRectUpdated=!0}return a?(b=this._transformedRect,a=this.GetPosition(),new cf.Rect(b.Left-
a.x,b.Top-a.y,b.Width,b.Height)):this._transformedRect};
cf.Sprite.prototype.Draw=function(a){var b=this._subrect;if(this._image&&b.Width&&b.Height)b.Left+b.Width>this._image.width||b.Top+b.Height>this._image.height?(a.beginPath(),a.moveTo(0,0),a.lineTo(b.Width,0),a.lineTo(b.Width,b.Height),a.lineTo(0,b.Height),a.closePath(),a.clip(),a.translate(-b.Left,-b.Top),a.fillStyle=a.createPattern(this._image,"repeat"),a.fillRect(0,0,b.Width+b.Left,b.Height+b.Top)):a.drawImage(this._image,b.Left,b.Top,b.Width,b.Height,0,0,b.Width,b.Height)};
cf.Text=function(a,b,c,d,e,f,h,j,g,k){this._string=a||"";this._font=c||"sans-serif";this._fontSize=b||16;this._stroke=!1;this._strokeWidth=1;this._rect=new cf.Rect;this._rectUpdated=!1;this._transformedRect=new cf.Rect;this._transformedRectUpdated=!1;this.Fill=!0;this.Color="#000";this.LineCap="butt";this.LineJoin="mitter";this.StrokeColor="#000";this.FillOverStroke=!1;this.Style="";this._offsetY=this._offsetX=0;this.SetPosition(d||0,e||0);this.SetScale(f||1,h||1);this.SetSkew(g||0,k||0);this.SetRotation(j||
0)};cf.Text.prototype=new cf.Drawable;cf.Text.prototype.SetString=function(a){this._string=a||"";this._transformedRectUpdated=this._rectUpdated=!1};cf.Text.prototype.GetString=function(){return this._string};cf.Text.prototype.SetFont=function(a){this._font=a||"sans-serif";this._transformedRectUpdated=this._rectUpdated=!1};cf.Text.prototype.GetFont=function(){return this._font};cf.Text.prototype.SetFontSize=function(a){this._fontSize=a;this._transformedRectUpdated=this._rectUpdated=!1};
cf.Text.prototype.GetFontSize=function(){return this._fontSize};cf.Text.prototype.SetStrokeWidth=function(a){this._strokeWidth=a;this._transformedRectUpdated=this._rectUpated=!1};cf.Text.prototype.GetStrokeWidth=function(){return this._strokeWidth};cf.Text.prototype.DrawStroke=function(a){this._stroke=a||!0;this._transformedRectUpdated=this._rectUpated=!1};
cf.Text.prototype.GetRect=function(){if(!this._rectUpdated){var a=document.createElement("canvas");if(!a.getContext)return null;var b=a.getContext("2d");b.font=this.Style+" "+this._fontSize+"px "+this._font;var c=a=0,b=b.measureText(this._string).width,d=this._fontSize;this._stroke&&strokeWidth&&(a=c-=this._strokeWidth/2,b+=this._strokeWidth,d+=this._strokeWidth);this._rect=new cf.Rect(a,c,b,d);this._rectUpdated=!0}return this._rect};
cf.Text.prototype.Draw=function(a){if(this._string&&!(this._string==""||!this._stroke&&!this.Fill)){a.textBaseline="bottom";a.font=this.Style+" "+this._fontSize+"px "+this._font;if(this._stroke&&strokeWidth)a.strokeStyle=this.StrokeColor,a.lineWidth=this._strokeWidth,a.lineCap=this.LineCap,a.lineJoin=this.LineJoin;if(this.Fill)a.fillStyle=this.Color;var b=this._offsetX,c=this._offsetY;this.ShadowBlur||(c=b=0);this._stroke&&strokeWidth&&this.FillOverStroke&&a.strokeText(this._string,b,this._fontSize+
c);this.Fill&&a.fillText(this._string,b,this._fontSize+c);this._stroke&&strokeWidth&&!this.FillOverStroke&&a.strokeText(this._string,b,this._fontSize+c)}};cf.Text.prototype._transformed=function(){this._transformedRectUpdated=!1};
cf.Text.prototype.GetTransformedRect=function(a){if(!this._transformedRectUpdated){var b=this.GetRect(),c=this._transformedRect,d=this._getMatrix(),e=d.Transform(0,0),f=d.Transform(b.Width,0),h=d.Transform(b.Width,b.Height),b=d.Transform(0,b.Height);c.Left=Math.min(e.x,f.x,h.x,b.x);c.Top=Math.min(e.y,f.y,h.y,b.y);c.Width=Math.max(e.x,f.x,h.x,b.x)-c.Left;c.Height=Math.max(e.y,f.y,h.y,b.y)-c.Top;this._transformedRectUpdated=!0}return a?(b=this._transformedRect,a=this.GetPosition(),new cf.Rect(b.Left-
a.x,b.Top-a.y,b.Width,b.Height)):this._transformedRect};cf.Text.prototype.SetupShadowAsBlur=function(a){a?(this._offsetY=this._offsetX=-99999,this.ShadowOffsetY=this.ShadowOffsetX=99999):this.ShadowOffsetY=this.ShadowOffsetX=this._offsetY=this._offsetX=0};
cf.Shape=function(a,b,c,d,e,f){this.LineColor="#000";this.LineWidth=1;this.LineCap="butt";this.LineJoin="mitter";this.FillColor="#000";this.Stroke=this.FillOverStroke=!1;this.Fill=!0;if(a)this.Path=a;this.SetPosition(b||0,c||0);this.SetScale(d||1,e||1);this.SetRotation(f||0)};cf.Shape.prototype=new cf.Drawable;cf.Shape.prototype.Path=function(){};
cf.Shape.prototype.Draw=function(a){if((this.Fill||this.Stroke)&&this.Path){if(this.Stroke)a.strokeStyle=this.LineColor,a.lineWidth=this.LineWidth,a.lineCap=this.LineCap,a.lineJoin=this.LineJoin;if(this.Fill)a.fillStyle=this.FillColor;a.beginPath();this.Path(a);a.closePath();this.Stroke&&this.FillOverStroke&&a.stroke();this.Fill&&a.fill();this.Stroke&&!this.FillOverStroke&&a.stroke()}};
cf.Shape.prototype.IsPointInside=function(a,b){var c=document.createElement("canvas");if(!c.getContext)return!1;c=c.getContext("2d");if(!(1 in arguments))b=a.y,a=a.x;c.beginPath();this.Path(c);c.closePath();return c.isPointInPath(a,b)};cf.Shape.Rect=function(a,b,c,d){typeof a!="object"&&(a=new cf.Rect(a||0,b||0,c||0,d||0));var e=new cf.Shape;e.Rect=a;e.Path=function(a){var b=e.Rect;a.rect(b.Left,b.Top,b.Width,b.Height)};return e};
cf.Shape.Circle=function(a,b,c){typeof b!="object"&&(b={x:b||0,y:c||0});var d=new cf.Shape;d.Center=b;d.Radius=a||0;d.Path=function(a){var b=d.Center;a.arc(b.x,b.y,d.Radius,0,6.283185307179586,!0)};return d};cf.DataImage=function(a){this._data=[];this.Height=this.Width=0;0 in arguments&&this.LoadImage(a)};
cf.DataImage.prototype.LoadImage=function(a){var b=document.createElement("canvas");if(b.getContext){var c=b.getContext("2d");b.width=this.Width=a.width;b.height=this.Height=a.height;c.drawImage(a,0,0);this._data=c.getImageData(0,0,b.width,b.height).data}};cf.DataImage.prototype.GetColor=function(a,b){if(!this.Width||!this.Height||!this._data)return null;if(typeof a=="object")b=a.y,a=a.x;a%=this.Width;b%=this.Height;var c=this._data,d=(b*this.Width+a)*4;return{r:c[d],g:c[d+1],b:c[d+2],a:c[d+3]}};
cf.DataImage.prototype.GetHexColor=function(a,b){var c=this.GetColor(a,b);if(!c)return"#FFF";return"#"+(c.b|c.g<<8|c.r<<16).toString(16)};cf.MaskImage=function(a,b){this._target=new cf.RenderTarget(1,1);this._mask=null;this.Height=this.Width=0;if(b)this.DrawFunc=b;a&&this.SetMask(a)};cf.MaskImage.prototype.DrawFunc=function(){};
cf.MaskImage.prototype.SetMask=function(a){if(!a)return this._mask=null;if(a._canvas)a=a._canvas;this._mask=a;this.Width=a.width;this.Height=a.height;this._target=new cf.RenderTarget(a.width,a.height)};cf.MaskImage.prototype.GetImage=function(){if(this._mask==null)return null;var a=this._target._ctx;a.save();this.DrawFunc(this._target);a.restore();a.globalCompositeOperation="destination-in";a.drawImage(this._mask,0,0);return this._target._canvas};cf.Ajax={};cf.Ajax._requests=[];
cf.Ajax._createRequest=function(){var a=-1,b=cf.Ajax._requests;for(i in b)if(b[i].free){a=i;break}if(a==-1)if(a=b.length,b[a]={free:!0,xmlhttp:null},window.XMLHttpRequest)b[a].xmlhttp=new XMLHttpRequest;else if(window.ActiveXObject)b[a].xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");return b[a]};cf.Ajax.Get=function(a,b){var c=cf.Ajax._createRequest(),d=c.xmlhttp;if(d)c.free=!1,d.onreadystatechange=function(){if(typeof b!="undefined"&&d.readyState==4)b(d),c.free=!0},d.open("GET",a,!0),d.send()};
cf.Ajax.Post=function(a,b,c){var d=cf.Ajax._createRequest(),e=d.xmlhttp;if(e)d.free=!1,e.onreadystatechange=function(){if(typeof c!="undefined"&&e.readyState==4)c(e),d.free=!0},e.open("POST",a,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(b)};cf.ResLoader=function(){this._res=[];this._total=this._loaded=this._percent=0;this._cbcalled=this._started=this._touching=!1};cf.ResLoader.prototype.GetTotalFiles=function(){return this._total};
cf.ResLoader.prototype.GetPercent=function(){return this._percent};cf.ResLoader.prototype.Add=function(a,b){a&&a!=""&&(1 in arguments?this._res.push({url:a,type:b}):this._res.push(a))};
cf.ResLoader.prototype.Start=function(){if(this._res.length){this._cbcalled=!1;this._started=!0;this._percent=this._loaded=0;this._total=this._res.length;for(var a=this,b=function(){a._touching&&setInterval(this,10);a._touching=!0;a._loaded++;a._percent=a._loaded/a._total;a._touching=!1},c;c=this._res.shift();)if(typeof c=="object"){var d=document.createElement(c.type);d.src=c.url;if(c.type=="img")d.addEventListener("load",b,!1);else{var e=/[^.]+$/.exec(c.url)[0].toLowerCase();console.log(e);if(e==
"mp3"&&d.canPlayType("audio/mpeg")!=""||e=="ogg"&&d.canPlayType("audio/ogg")!=""||e=="wav"&&d.canPlayType("audio/wav")!=""){var f=function(){d.readyState?b():setTimeout(f,250)};f()}else b(),alert(c.url+" couldn't be loaded and is ignored, the application may not function properly")}}else typeof c=="string"&&cf.Ajax.Get(c,function(a){b();a.status!=200&&alert(c+" couldn't be loaded and is ignored, the application may not function properly")})}};
cf.ResLoader.prototype.Loading=function(a){if(this._cbcalled==!0)return!1;return this._percent===1?(a&&a(),this._cbcalled=!0,!1):(this._started||this.Start(),!0)};cf.Gradiant=function(){};